flowchart TD
  A([شروع]) --> B[دریافت اطلاعات مسافر و گزینه سفر]
  B --> C[بازبینی ظرفیت/قیمت]
  C --> D{تأیید شد؟}
  D -- خیر --> X[نمایش پیام تغییر قیمت/عدم موجودی] --> Z([پایان])
  D -- بله --> E[ایجاد سفارش «در انتظار پرداخت» + کلید یکتایی]
  E --> F[شروع پرداخت]
  F --> G[بازگشت بانک]
  G --> H[راستی‌آزمایی پرداخت]
  H --> I{نتیجه پرداخت}
  I -- موفق --> J[شروع صدور بلیت]
  I -- ناموفق/مبهم --> Y[ثبت «نیازمند بررسی/ناموفق» + پیام مناسب] --> Z
  J --> K{صدور موفق؟}
  K -- بله --> L[ثبت بلیت + اعلان] --> Z
  K -- خیر --> M[ثبت خطا + تلاش‌مجدد + تیکت پشتیبانی] --> Z

